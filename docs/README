Hopscotch
=========
Hopscotch is a framework to make it easy for developers to add product tours to their pages. Hopscotch accepts a tour JSON object as input and provides an API for the developer to control rendering the tour display and managing the tour progress.

Features
========
* Callbacks for tour events (e.g. onStart, onEnd, onShow, onNext, onPrev, onClose)
* Multi-page persistence using HTML5 sessionStorage using cookies as a fallback
* I18N support

General Usage
=============

To get started using the Hopscotch framework, simply include `hopscotch.css` and `hopscotch.js` on your page. This will load the hopscotch object into the global window object for you.

    <html>
      <head>
        <title>My First Hopscotch Tour</title>
        <link rel="stylesheet" href="css/hopscotch.css"></link>
      </head>
      <body>
        <h1 id="header">My First Hopscotch Tour</h1>
        <div id="content">
          <p>Content goes here...</p>
        </div>
        <script src="js/hopscotch.js"></script>
        <script src="js/my_first_tour.js"></script> <!-- define and start your tour in this file -->
      </body>
    </html>

Then in your `my_first_tour.js` file, define and start your tour.

    // Define the tour!
    var tour = {
      id: "hello-hopscotch",
      steps: [
        {
          title: "My Header",
          content: "This is the header of my page.",
          target: "header",
          orientation: "right"
        },
        {
          title: "My content",
          content: "Here is where I put my content.",
          target: document.querySelector("#content p"),
          orientation: "bottom"
        }
      ]
    };

    // Start the tour!
    hopscotch.startTour(tour);

That's all there is to it!

Defining a Tour
===============
A Hopscotch tour consists of a tour id, an array of tour steps defined as JSON objects, and a number of tour-specific options. The tour id is simply a unique identifier string. The simplest tour consists of just an id string and an array of one or more steps.

Basic step options
------------------
The step options below are the most basic options.

    {
      id: {STRING - id of the tour},
      steps: [
        {
          // MANDATORY
          target:         STRING/ELEMENT - id of the target DOM element or DOM element itself,
          orientation:    STRING         - ["top", "bottom", "right", "left"]
          // OPTIONAL
          title:          STRING         - step title,
          content:        STRING         - step content
        },
        ...
      ]
    };

Note that title and content are both optional only because you can choose to have a step with only a title, only content, or both title and content.

This is an example of a tour defined with only basic steps.

    {
      id: "welcome_tour",
      steps: [
        {
          target: "header",
          orientation: "bottom",
          title: "This is the navigation menu",
          content: "Use the links here to get around on our site!"
        },
        {
          target: "profile-pic",
          orientation: "right",
          title: "Your profile picture",
          content: "Upload a profile picture here. This is the image that others will see next to your activity."
        },
        {
          target: "inbox",
          orientation: "bottom",
          title: "Your inbox",
          content: "Messages from other users will appear here."
        }
      ]
    }

**IMPORTANT** -- title and content are set using element.innerHTML. This allows the inclusion of very basic markup like links and lists. However, it also allows the inclusion of malicious script injections when used improperly. It is highly recommended to never show user-generated content in a Hopscotch tour. If it is absolutely necessary, you must properly escape the input, as always.

All step options
----------------
The comprehensive list of step options are listed below:

### MANDATORY ###

**target** [STRING/ELEMENT/ARRAY] - id of the target DOM element or DOM element itself. It is also possible to define an array of several targets. If an array is provided, Hopscotch will use the first target that exists on the page and disregard the rest.

**orientation** [STRING] - specifies where the bubble should appear in relation to the target. Valid values are "top", "bottom", "right", "left".

### OPTIONAL ###

**title** [STRING] - step title

**content** [STRING] - step content

**width** [INT] - bubble width

**padding** [INT] - bubble padding

**xOffset** [INT] - horizontal position adjustment for bubble. *Default*: 0.

**yOffset** [INT] - vertical position adjustment for bubble. *Default*: 0.

**arrowOffset** [INT] - offset for the bubble arrow. *Default*: 0.

**delay** [INT] - number in milliseconds to wait before showing step. *Default*: 0.

**zindex** [INT] - sets the z-index of the bubble

**showNextButton** [BOOLEAN] - should show the next button. *Default*: true.

**showPrevButton** [BOOLEAN] - should show the prev button. *Default*: true.

**showCTAButton** [BOOLEAN] - should show the call-to-action button. *Default*: false.

**ctaLabel** [STRING] - label for the call-to-action button.

**multipage** [BOOLEAN] - indicates that the next step is on a different page. *Default*: false.

**showSkip** [BOOLEAN] - if true, 'Next' button reads 'Skip'. *Default*: false.

**fixedElement** [BOOLEAN] - set to true if the target element has fixed positioning. *Default*: false.

**nextOnTargetClick** [BOOLEAN] - triggers nextStep() when the target is clicked. *Default*: false.

**onPrev** [FUNCTION] - callback for when 'Previous' button is clicked}

**onNext** [FUNCTION] - callback for when 'Next' button is clicked}

**onShow** [FUNCTION] - callback for when step is first displayed}

**onCTA** [FUNCTION] - callback for the optional call-to-action button}

Setting tour options
--------------------
Tour options can be specified either through the tour JSON object, or through a call to hopscotch.configure().

**bubbleWidth** [NUMBER] - Default bubble width. *Default*: 280.

**bubblePadding** [NUMBER] - Default bubble padding. *Default*: 15.

**smoothScroll** [BOOLEAN] - Should the page scroll smoothly to the next step? *Default*: true.

**scrollDuration** [NUMBER] - Duration of page scroll in milliseconds. Only relevant when smoothScroll is set to true. *Default*: 1000.

**scrollTopMargin** [NUMBER] - When the page scrolls, how much space should there be between the bubble/targetElement and the top of the viewport? *Default*: 200.

**showCloseButton** [BOOLEAN] - Should the tour bubble show a close (X) button? *Default*: true.

**showPrevButton** [BOOLEAN] - Should the bubble have the Previous button? *Default*: false.

**showNextButton** [BOOLEAN] - Should the bubble have the Next button? *Default*: true.

**arrowWidth** [NUMBER] - Default arrow width. (space between the bubble and the targetEl) Used for bubble position calculation. This option is provided for the case where the developer wants to use custom CSS to adjust the size of the arrow. *Default*: 20.

**skipIfNoElement** [BOOLEAN] - If a specified target element is not found, should we skip to the next step? *Default*: true.

**nextOnTargetClick** [BOOLEAN] - Should we advance to the next step when the user clicks on the target? *Default*: false.

**onNext** [FUNCTION] - Invoked after every click on a "Next" button.

**onPrev** [FUNCTION] - Invoked after every click on a "Prev" button.

**onStart** [FUNCTION] - Invoked when the tour is started.

**onEnd** [FUNCTION] - Invoked when the tour ends.

**onClose** [FUNCTION] - Invoked when the user closes the tour before finishing.

**onError** [FUNCTION] - Invoked when the specified target element doesn't exist on the page.

**i18n** [OBJECT] - For i18n purposes. Allows you to change the text of button labels and step numbers.

**i18n.nextBtn** [STRING] - Label for next button

**i18n.prevBtn** [STRING] - Label for prev button

**i18n.doneBtn** [STRING] - Label for done button

**i18n.skipBtn** [STRING] - Label for skip button

**i18n.closeTooltip** [STRING] - Text for close button tooltip

**i18n.stepNums** [ARRAY<STRING>] - Provide a list of strings to be shown as the step number, based on index of array. Unicode characters are supported. (e.g., ['&#x4e00;', '&#x4e8c;', '&#x4e09;']) If there are more steps than provided numbers, Arabic numerals ('4', '5', '6', etc.) will be used as default.

Running, Managing, and Ending a Tour
====================================

The Hopscotch framework comes with a simple set of API calls:

* `hopscotch.startTour(tour, stepNum)` - Actually starts the tour. Optional stepNum argument specifies what step to start at.
* `hopscotch.showStep(idx)` - Skips to a given step in the tour
* `hopscotch.prevStep()` - Goes back one step in the tour
* `hopscotch.nextStep()` - Goes forward one step in the tour
* `hopscotch.endTour([clearCookie])` - Ends the current tour. If clearCookie is set to false, the tour state is preserved. Otherwise, if clearCookie is set to true or is not provided, the tour state is cleared.
* `hopscotch.configure(options)` - Sets options for running the tour. Note: if this method is called after loading a tour, the options specified will override the options defined in the tour. See above section "Setting tour options" for a list of configuration options.

Defining callbacks
==================

Hopscotch has several events to which you can assign callbacks. These events include *start*, *end*, *next*, *prev*, *show*, *close*, *error*. For the *next*, *prev*, and *show* events, you can assign callbacks within step definitions as well as in the tour itself.

There are two ways to define event callbacks:

Function literals
-----------------
If you are specifying your tour as an object literal in Javascript, you can provide a function literal as the value of your callback. This would look like the following:

    var tour = {
      id: 'myTour',
      steps: [
        {
          target: 'firststep',
          orientation: 'bottom',
          title: 'My First Step',
          onNext: function() {
            $('#firststep').hide();
          }
        }
      ],
      onStart: function() {
        $('#article').addClass('selected');
      }
    };

Helpers
-------
In some situations, you may want to specify your tour in JSON. This may be because you are dynamically creating a tour on the server side. Since functions are not valid JSON, specifying a function literal will not work. Instead, you can use Hopscotch helpers to specify your callback. Using helpers will look something like the following.

First register the helper with Hopscotch.

    hopscotch.registerHelper('selectArticle', function() {
      $('#article').addClass('selected');
    });

An example with an argument passed in:

    hopscotch.registerHelper('fillText', function(textFieldId, textStr) {
      document.getElementById(textFieldId).value = textStr;
    });

Then, when you define your tour, you specify the callback as an array of the following form: `[helperId, arg, arg, ...]`. For example:

    {
      id: "myTour",
      steps: [
        {
          target: "firststep",
          orientation: "bottom",
          title: "My First Step",
          onNext: ["fillText", "searchField", "Example search query"]
        }
      ],
      onStart: ["selectArticle"]
    }

In the above example, since the onStart callback has no arguments, it could be defined as a simple string "selectArticle" instead of being wrapped in a one-element array.

To specify several helpers for a certain event:

    {
      id: "myTour",
      steps: [
        ...
      ],
      onStart: [["fillText", "searchField", "Example search query"], "selectArticle"]
    }

Callbacks will be invoked in the order that they are specified.

To remove a helper, simply call `hopscotch.unregisterHelper('myHelperId')`.

Demo Tour
=========

    {
      "id": "hello-hopscotch",
      "steps: [
        {
          "title: "Welcome to the Hopscotch Demo Page!",
          "content": "Hey there! Welcome to the Hopscotch Demo Page!",
          "target": "subheading",
          "orientation": "bottom",
          "arrowOffset": 30,
          "onNext": function() {
            document.getElementById("pageTitle").style.color = "#f00";
          },
        },
        {
          "title": "Mission District",
          "content": "Here is a heat map of in the Mission District!",
          "target": "mission",
          "orientation": "top",
          "xOffset": 100,
          "arrowOffset": 100
        },
        {
          "title": "Cool wave",
          "content": "This is a <b>colorful</b> wave. Here is the the <a href="http://imgur.com/s632o" target="_new">page</a> where I found it.",
          "target": "wave",
          "orientation": "bottom",
          "width": 500,
        },
        {
          "title": "Multi-page test",
          "content": "Are you ready? We\'re going to try hopping to another page and then back!!! Where we\'re going, we won\'t need roads...",
          "target": "secpagelink",
          "orientation": "bottom",
          "showNextButton": false,
          "onNext": ['goTo', 'secondpage.html'],
          "multipage": true
        },
        {
          "title": "Polar bears",
          "content": "We made it!! Polar bears are very interesting creatures.",
          "target": "polarbears",
          "orientation": "right",
          "showPrevButton": false
        }
      ],
      "onNext": function(tourId, idx) {
        console.log("Next step");
      }
    }
